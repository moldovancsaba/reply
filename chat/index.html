<!DOCTYPE html>
<html lang="en">

<head>
  <script>
    window.onerror = function (msg, url, line, col, error) {
      console.error('[GLOBAL ERROR]', { msg, url, line, col, error });
      // Only alert once to avoid spamming
      if (!window.__errorAlerted) {
        window.__errorAlerted = true;
        alert("CRITICAL UI ERROR: " + msg + "\nFile: " + url + "\nLine: " + line);
      }
      return false;
    };
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{reply}</title>
  <link rel="stylesheet" href="css/global.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/app.css">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
</head>

<body>
  <div class="app-container">
    <!-- PANE A: SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div style="display:flex; gap:10px; align-items:center;">
          <span id="btn-dash" class="material-symbols-outlined"
            style="font-size: 28px; color: var(--text-primary); cursor: pointer;" title="Go to Dashboard">
            flip_camera_android
          </span>
          <span id="btn-settings" class="material-symbols-outlined"
            style="font-size: 24px; color: var(--text-primary); cursor: pointer;" title="Settings">
            settings
          </span>
          <span id="btn-training" class="material-symbols-outlined"
            style="font-size: 24px; color: var(--text-primary); cursor: pointer;" title="Agent Training">
            model_training
          </span>
        </div>
        <div id="sync-status" title="Sync Status">
          <span class="status-dot active"></span>
        </div>
        <!-- Sync buttons moved to individual cards -->
      </div>
      <div class="sidebar-search">
        <input id="contact-search" class="sidebar-search-input" type="search" placeholder="Search contacts..."
          autocomplete="off" spellcheck="false">
      </div>
      <div id="contact-list" class="contact-list">
        <!-- Contact Items will be injected here -->
      </div>
    </aside>

    <!-- PANE B: MAIN CHAT -->
    <main class="chat-area">
      <header class="chat-header">
        <div style="display:flex; align-items:center; gap:12px;">
          <div id="active-contact-name-chat" style="font-weight: 700; font-size: 1.1rem;">Select a contact</div>
          <select id="status-select" onchange="updateManualStatus()"
            style="font-size:0.8rem; border-radius:12px; border:1px solid #ddd; padding:2px 8px; cursor:pointer; display:none;">
            <option value="open">ðŸŸ¢ Active</option>
            <option value="draft">ðŸŸ  Draft Ready</option>
            <option value="closed">ðŸ”µ Resolved</option>
          </select>
        </div>
        <div style="display: flex; gap: 8px;">
          <button class="btn btn-primary" id="btn-mic" title="Voice Input" style="display:none;">ðŸŽ¤ Mic</button>
          <button class="btn btn-primary" id="btn-magic" title="Instant Polish" style="display:none;">âœ¨ Magic</button>
          <button class="btn btn-primary" id="btn-suggest" style="display:none;">ðŸ’¡ Suggest</button>
        </div>
      </header>

      <div class="input-area">
        <div class="input-wrapper">
          <textarea id="chat-input" rows="1" placeholder="Type a message..."></textarea>
          <select id="channel-select" class="channel-select" title="Channel">
            <option value="imessage">iMessage</option>
            <option value="whatsapp">WhatsApp</option>
            <option value="linkedin">LinkedIn</option>
            <option value="email">Email</option>
            <option value="telegram">Telegram (Draft only)</option>
            <option value="discord">Discord (Draft only)</option>
          </select>
          <button id="btn-send" class="btn btn-primary">Send</button>
        </div>
        <div id="channel-policy-hint" class="channel-policy-hint" style="display:none;"></div>
        <div id="suggestion-explanation" class="suggestion-explanation" style="display:none;"></div>
      </div>

      <div id="messages" class="messages-container">
        <!-- Messages will be injected here -->
      </div>

      <div id="dashboard" class="dashboard" style="display:none;">
        <!-- Dashboard items will be injected here -->
      </div>

      <!-- Agent Training Page -->
      <div id="training-page" class="settings-page" style="display:none; overflow-y:auto;">
        <div class="settings-page-shell"
          style="max-width: 800px; margin: 0 auto; height:100%; display:flex; flex-direction:column;">
          <div class="settings-page-topbar">
            <div>
              <div class="settings-page-title">Agent Training</div>
              <div class="settings-page-subtitle">Review, refine, and manage golden examples for your generative persona
              </div>
            </div>
            <div class="settings-page-actions">
              <button id="training-close" class="btn btn-secondary btn-sm">Close</button>
            </div>
          </div>
          <div id="training-list-container" style="flex:1; overflow-y:auto; padding-top: 20px;">
            <div style="font-size:0.9rem; color:var(--text-secondary); text-align:center;">Loading examples...</div>
          </div>
        </div>
      </div>

      <!-- Settings Page -->
      <div id="settings-page" class="settings-page" style="display:none;">
        <div class="settings-page-shell">
          <div class="settings-page-topbar">
            <div>
              <div class="settings-page-title">Settings</div>
              <div class="settings-page-subtitle">Local-only configuration for this machine</div>
            </div>
            <div class="settings-page-actions">
              <button id="settings-close" class="btn btn-secondary btn-sm">Back</button>
              <button id="settings-save" class="btn btn-primary btn-sm">Save</button>
            </div>
          </div>

          <div class="settings-services">
            <div class="settings-services-label">Configure a service:</div>
            <div class="settings-services-actions">
              <button type="button" class="btn btn-secondary btn-sm"
                onclick="window.openChannelSettings('imessage')">iMessage</button>
              <button type="button" class="btn btn-secondary btn-sm"
                onclick="window.openChannelSettings('whatsapp')">WhatsApp</button>
              <button type="button" class="btn btn-secondary btn-sm"
                onclick="window.openChannelSettings('email')">Email</button>
              <button type="button" class="btn btn-secondary btn-sm"
                onclick="window.openChannelSettings('bridge')">Bridge</button>
              <button type="button" class="btn btn-secondary btn-sm"
                onclick="window.openChannelSettings('notes')">Notes</button>
            </div>
          </div>

          <div id="settings-filter-bar" class="settings-filter-bar" style="display:none;">
            <div id="settings-filter-label" class="settings-filter-label">Configuring</div>
            <button id="settings-show-all" class="btn btn-ghost btn-sm">General Settings</button>
          </div>

          <div id="settings-modal-scroll" class="settings-page-scroll">
            <div id="settings-section-global" class="settings-section">
              <div class="settings-section-title">Core Credentials & Security</div>

              <div class="settings-grid">
                <div class="settings-field">
                  <label class="settings-label" for="settings-global-google-api-key">Gemini API Key</label>
                  <input id="settings-global-google-api-key" type="password" class="settings-input"
                    placeholder="Leave blank to keep existing">
                  <div id="settings-global-google-api-key-hint" class="settings-hint">Not set</div>
                </div>

                <div class="settings-field">
                  <label class="settings-label" for="settings-global-operator-token">Operator Token</label>
                  <input id="settings-global-operator-token" type="password" class="settings-input"
                    placeholder="Leave blank to keep existing">
                  <div id="settings-global-operator-token-hint" class="settings-hint">Not set</div>
                </div>
              </div>

              <div class="settings-grid settings-grid-2 mt-md">
                <div class="settings-checkbox-group">
                  <input id="settings-global-require-token" type="checkbox">
                  <label for="settings-global-require-token" class="settings-checkbox-label">Enforce Token</label>
                </div>
                <div class="settings-checkbox-group">
                  <input id="settings-global-local-writes" type="checkbox">
                  <label for="settings-global-local-writes" class="settings-checkbox-label">Local Writes Only</label>
                </div>
              </div>

              <div class="settings-grid settings-grid-2 mt-sm">
                <div class="settings-checkbox-group">
                  <input id="settings-global-require-approval" type="checkbox">
                  <label for="settings-global-require-approval" class="settings-checkbox-label">Human Approval</label>
                </div>
                <div class="settings-checkbox-group">
                  <input id="settings-global-desktop-fallback" type="checkbox">
                  <label for="settings-global-desktop-fallback" class="settings-checkbox-label">Desktop Fallback</label>
                </div>
              </div>

              <div class="settings-field mt-md">
                <label class="settings-label" for="settings-global-whatsapp-transport">WhatsApp Send Transport</label>
                <select id="settings-global-whatsapp-transport" class="settings-input mt-xs">
                  <option value="openclaw_cli">OpenClaw CLI</option>
                  <option value="desktop_automation">Desktop Automation</option>
                </select>
              </div>
            </div>

            <div id="settings-channel-mail" class="settings-section mt-sm">
              <div class="settings-section-title">Email (IMAP / Gmail)</div>

              <div class="settings-grid" style="grid-template-columns: 1fr 120px;">
                <div class="settings-field">
                  <label class="settings-label" for="settings-imap-host">Host</label>
                  <input id="settings-imap-host" class="settings-input" placeholder="imap.gmail.com">
                </div>
                <div class="settings-field">
                  <label class="settings-label" for="settings-imap-port">Port</label>
                  <input id="settings-imap-port" class="settings-input" value="993">
                </div>
              </div>

              <div class="settings-checkbox-group mt-sm">
                <input id="settings-imap-secure" type="checkbox" checked>
                <label for="settings-imap-secure" class="settings-checkbox-label">Use TLS</label>
              </div>

              <div class="settings-field">
                <label class="settings-label" for="settings-imap-user">Username</label>
                <input id="settings-imap-user" class="settings-input" placeholder="you@gmail.com">
              </div>

              <div class="settings-field">
                <label class="settings-label" for="settings-imap-pass">Password (Gmail: App Password)</label>
                <input id="settings-imap-pass" type="password" class="settings-input"
                  placeholder="Leave blank to keep existing">
                <div id="settings-imap-pass-hint" class="settings-hint">Not set</div>
              </div>

              <div class="settings-grid settings-grid-2 mt-sm">
                <div class="settings-field">
                  <label class="settings-label" for="settings-imap-mailbox">Mailbox</label>
                  <input id="settings-imap-mailbox" class="settings-input" value="INBOX">
                </div>
                <div class="settings-field">
                  <label class="settings-label" for="settings-imap-sent-mailbox">Sent Mailbox (optional)</label>
                  <input id="settings-imap-sent-mailbox" class="settings-input" placeholder="[Gmail]/Sent Mail">
                </div>
              </div>

              <div class="settings-grid settings-grid-2 mt-sm">
                <div class="settings-field">
                  <label class="settings-label" for="settings-imap-limit">Fetch limit / run</label>
                  <input id="settings-imap-limit" class="settings-input" value="200">
                </div>
                <div class="settings-field">
                  <label class="settings-label" for="settings-imap-since-days">First-run lookback (days)</label>
                  <input id="settings-imap-since-days" class="settings-input" value="30">
                </div>
              </div>

              <div class="settings-field">
                <label class="settings-label" for="settings-self-emails">Self emails (comma-separated, optional)</label>
                <input id="settings-self-emails" class="settings-input" placeholder="me@domain.com, alias@domain.com">
              </div>

              <div class="settings-hint mt-sm">
                Stored locally on this machine (not encrypted). Use an App Password for Gmail.
              </div>
            </div>

            <div id="settings-channel-gmail" class="settings-section mt-sm">
              <div class="settings-section-title">Gmail (OAuth)</div>

              <div class="settings-field">
                <label class="settings-label" for="settings-gmail-client-id">OAuth Client ID</label>
                <input id="settings-gmail-client-id" class="settings-input"
                  placeholder="xxxx.apps.googleusercontent.com">
              </div>

              <div class="settings-field">
                <label class="settings-label" for="settings-gmail-client-secret">OAuth Client Secret</label>
                <input id="settings-gmail-client-secret" type="password" class="settings-input"
                  placeholder="Leave blank to keep existing">
                <div id="settings-gmail-client-secret-hint" class="settings-hint">Not set</div>
              </div>

              <div id="settings-gmail-status" class="settings-label mt-sm">Not connected</div>

              <div class="settings-grid settings-grid-2 mt-md">
                <div class="settings-field">
                  <label class="settings-label" for="settings-gmail-scope">Sync scope</label>
                  <select id="settings-gmail-scope" class="settings-input">
                    <option value="inbox_sent">Inbox + Sent</option>
                    <option value="all_mail">All Mail (exclude Spam/Trash)</option>
                    <option value="custom">Custom query</option>
                  </select>
                </div>
                <div class="settings-field">
                  <label class="settings-label" for="settings-gmail-query">Custom query</label>
                  <input id="settings-gmail-query" class="settings-input"
                    placeholder='e.g. label:finance OR from:foo@bar.com'>
                </div>
              </div>

              <div class="settings-button-group">
                <button id="settings-gmail-disconnect" class="btn btn-ghost mx-sm">Disconnect</button>
                <button id="settings-gmail-connect" class="btn btn-primary mx-sm">Connect Gmail</button>
              </div>

              <div class="settings-hint mt-sm">
                Redirect URI must be registered in Google Cloud Console (usually
                <code>http://localhost:3000/api/gmail/oauth-callback</code>).
              </div>
            </div>

            <div id="settings-section-worker" class="settings-section mt-sm">
              <div class="settings-section-title">Background Worker</div>

              <div class="settings-grid settings-grid-2">
                <div id="settings-worker-interval-wrap" class="settings-field">
                  <label class="settings-label" for="settings-worker-interval">Poll interval (seconds)</label>
                  <input id="settings-worker-interval" class="settings-input" value="60">
                </div>
                <div id="settings-worker-gmail-wrap" class="settings-field">
                  <label class="settings-label" for="settings-worker-gmail-max">Gmail max / run</label>
                  <input id="settings-worker-gmail-max" class="settings-input" value="100">
                </div>
              </div>

              <div class="settings-grid settings-grid-2 mt-sm">
                <div id="settings-worker-imessage-wrap" class="settings-field">
                  <label class="settings-label" for="settings-worker-imessage-max">iMessage max / run</label>
                  <input id="settings-worker-imessage-max" class="settings-input" value="1000">
                </div>
                <div id="settings-worker-whatsapp-wrap" class="settings-field">
                  <label class="settings-label" for="settings-worker-whatsapp-max">WhatsApp max / run</label>
                  <input id="settings-worker-whatsapp-max" class="settings-input" value="500">
                </div>
              </div>

              <div id="settings-channel-notes" class="settings-field mt-sm">
                <label class="settings-label" for="settings-worker-notes-max">Notes max / run (0 = unlimited)</label>
                <input id="settings-worker-notes-max" class="settings-input" value="0">
              </div>
            </div>

            <div id="settings-section-channel-bridge" class="settings-section mt-sm">
              <div class="settings-section-title">Channel Bridge (Inbound)</div>

              <div class="settings-grid settings-grid-2">
                <div class="settings-field">
                  <label class="settings-label" for="settings-bridge-telegram-mode">Telegram inbound mode</label>
                  <select id="settings-bridge-telegram-mode" class="settings-input">
                    <option value="draft_only">Draft only (recommended)</option>
                    <option value="disabled">Disabled</option>
                  </select>
                </div>
                <div class="settings-field">
                  <label class="settings-label" for="settings-bridge-discord-mode">Discord inbound mode</label>
                  <select id="settings-bridge-discord-mode" class="settings-input">
                    <option value="draft_only">Draft only (recommended)</option>
                    <option value="disabled">Disabled</option>
                  </select>
                </div>
              </div>

              <div class="settings-hint mt-sm">
                These flags are enforced server-side on <code>/api/channel-bridge/inbound</code>.
              </div>
            </div>

            <div id="settings-section-ui" class="settings-section mt-sm">
              <div class="settings-section-title">Channel UI</div>

              <div class="settings-grid">
                <div id="settings-channel-imessage" class="settings-card">
                  <div class="settings-card-title">iMessage</div>
                  <div class="settings-grid settings-grid-3 items-end">
                    <div class="settings-field mt-0">
                      <label class="settings-label" for="settings-ui-imessage-emoji">Emoji</label>
                      <input id="settings-ui-imessage-emoji" class="settings-input">
                    </div>
                    <div class="settings-field mt-0">
                      <label class="settings-label" for="settings-ui-imessage-me">My bubble</label>
                      <input id="settings-ui-imessage-me" type="color" class="settings-input settings-color-input">
                    </div>
                    <div class="settings-field mt-0">
                      <label class="settings-label" for="settings-ui-imessage-contact">Their bubble</label>
                      <input id="settings-ui-imessage-contact" type="color" class="settings-input settings-color-input">
                    </div>
                  </div>
                </div>

                <div id="settings-channel-whatsapp" class="settings-card">
                  <div class="settings-card-title">WhatsApp</div>
                  <div class="settings-grid settings-grid-3 items-end">
                    <div class="settings-field mt-0">
                      <label class="settings-label" for="settings-ui-whatsapp-emoji">Emoji</label>
                      <input id="settings-ui-whatsapp-emoji" class="settings-input">
                    </div>
                    <div class="settings-field mt-0">
                      <label class="settings-label" for="settings-ui-whatsapp-me">My bubble</label>
                      <input id="settings-ui-whatsapp-me" type="color" class="settings-input settings-color-input">
                    </div>
                    <div class="settings-field mt-0">
                      <label class="settings-label" for="settings-ui-whatsapp-contact">Their bubble</label>
                      <input id="settings-ui-whatsapp-contact" type="color" class="settings-input settings-color-input">
                    </div>
                  </div>
                </div>

                <div id="settings-channel-email" class="settings-card">
                  <div class="settings-card-title">Email</div>
                  <div class="settings-grid settings-grid-3 items-end">
                    <div class="settings-field mt-0">
                      <label class="settings-label" for="settings-ui-email-emoji">Emoji</label>
                      <input id="settings-ui-email-emoji" class="settings-input">
                    </div>
                    <div class="settings-field mt-0">
                      <label class="settings-label" for="settings-ui-email-me">My bubble</label>
                      <input id="settings-ui-email-me" type="color" class="settings-input settings-color-input">
                    </div>
                    <div class="settings-field mt-0">
                      <label class="settings-label" for="settings-ui-email-contact">Their bubble</label>
                      <input id="settings-ui-email-contact" type="color" class="settings-input settings-color-input">
                    </div>
                  </div>
                </div>

                <div id="settings-channel-linkedin" class="settings-card">
                  <div class="settings-card-title">LinkedIn</div>
                  <div class="settings-hint mb-md" style="line-height:1.4;">
                    LinkedIn integration is powered by the <strong>{reply} Chrome Extension</strong> and manual
                    <strong>Data Archive Imports</strong>.
                    <ul class="ml-lg mt-sm">
                      <li><strong>Messages:</strong> Synced automatically when you browse LinkedIn with the extension
                        active.</li>
                      <li><strong>Contacts/Posts:</strong> Synced by importing <code>Connections.csv</code> and
                        <code>Shares.csv</code> from your LinkedIn Data Archive.
                      </li>
                    </ul>
                  </div>
                  <div class="settings-grid settings-grid-3 items-end">
                    <div class="settings-field mt-0">
                      <label class="settings-label" for="settings-ui-linkedin-emoji">Emoji</label>
                      <input id="settings-ui-linkedin-emoji" class="settings-input">
                    </div>
                    <div class="settings-field mt-0">
                      <label class="settings-label" for="settings-ui-linkedin-me">My bubble</label>
                      <input id="settings-ui-linkedin-me" type="color" class="settings-input settings-color-input">
                    </div>
                    <div class="settings-field mt-0">
                      <label class="settings-label" for="settings-ui-linkedin-contact">Their bubble</label>
                      <input id="settings-ui-linkedin-contact" type="color" class="settings-input settings-color-input">
                    </div>
                  </div>

                  <div class="settings-section mt-md pt-md">
                    <div class="settings-section-title">Bridge Settings</div>
                    <div id="settings-bridge-linkedin-wrap" class="settings-field">
                      <label class="settings-label" for="settings-bridge-linkedin-mode">Inbound Mode</label>
                      <select id="settings-bridge-linkedin-mode" class="settings-input">
                        <option value="draft_only">Draft only (recommended)</option>
                        <option value="disabled">Disabled</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
    </main>

    <!-- PANE C: KYC DATA -->
    <section class="kyc-pane">
      <div id="kyc-empty-state" class="kyc-empty">
        <h3 class="kyc-empty-title">{reply} Overview</h3>
        <p class="kyc-empty-text">Select a contact from the sidebar to view their profile and history.</p>
        <div class="kyc-tip">
          <div class="kyc-tip-label">Quick Tip</div>
          <div class="kyc-tip-text">You can search contacts by name or handle.</div>
        </div>
      </div>

      <div id="kyc-content-editor" class="kyc-editor" style="display:none;">
        <div class="kyc-editor-header">
          <h3 class="kyc-editor-title">Profile</h3>
          <div class="kyc-editor-actions">
            <button id="btn-deep-analyze" class="btn btn-secondary btn-sm" title="Run Deep Analysis with Ollama">âœ¨
              Analyze</button>
            <button class="btn btn-secondary btn-sm" onclick="openMergeModal()">Merge</button>
            <button class="btn btn-primary btn-sm" onclick="saveInlineProfile(this)">Save</button>
          </div>
        </div>

        <div class="kyc-card">
          <div class="kyc-field">
            <label class="kyc-field-label" for="kyc-name-input">Display Name</label>
            <input id="kyc-name-input" class="kyc-field-input kyc-field-input--title" autocomplete="off">
          </div>

          <div class="kyc-field">
            <label class="kyc-field-label" for="kyc-role-input">Profession</label>
            <input id="kyc-role-input" class="kyc-field-input" autocomplete="off">
          </div>

          <div class="kyc-field">
            <label class="kyc-field-label" for="kyc-rel-input">Relationship</label>
            <input id="kyc-rel-input" class="kyc-field-input" autocomplete="off">
          </div>

          <div class="kyc-field">
            <label class="kyc-field-label" for="kyc-handle-input">Handle</label>
            <input id="kyc-handle-input" class="kyc-field-input kyc-field-input--mono" readonly>
          </div>
        </div>

        <div class="kyc-card">
          <div class="kyc-section">
            <div class="kyc-section-label">Channels</div>
            <div id="kyc-channels" class="kyc-section-body">
              <!-- Channels injected here -->
            </div>
          </div>

          <div class="kyc-section">
            <div class="kyc-section-label">AI Suggestions</div>
            <div id="kyc-suggestions" class="kyc-section-body">
              <!-- Suggestions injected here -->
            </div>
          </div>
        </div>

        <div class="kyc-card">
          <div class="kyc-section">
            <div class="kyc-section-label">Local Intelligence</div>
            <div id="notes-log" class="kyc-notes-log">
              <!-- Notes injected here -->
            </div>
            <div class="kyc-note-add">
              <input id="new-note-input" class="kyc-note-input" placeholder="Add a new observation...">
              <button class="btn btn-primary btn-icon btn-icon-sm" onclick="addNote()" title="Add note">+</button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Merge Profile Modal -->
  <div id="merge-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
      <h3 class="mt-0">Merge Contact</h3>
      <p class="mb-md" style="font-size: 0.9rem; color: var(--text-secondary);">Select the primary identity to merge
        <strong id="merge-source-handle"></strong> into. All channels and history will be transferred.
      </p>
      <div class="settings-field mt-0">
        <label class="settings-label">Target Primary Handle:</label>
        <input id="merge-target-handle" class="settings-input" placeholder="e.g. jdoe or +1234567890">
      </div>
      <div class="settings-button-group mt-0">
        <button onclick="closeMergeModal()" class="btn btn-ghost mx-sm">Cancel</button>
        <button id="execute-merge-btn" onclick="executeMerge(this)" class="btn btn-primary mx-sm">Merge</button>
      </div>
    </div>
  </div>

  <!-- Profile Edit Modal -->
  <div id="profile-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
      <h3 class="mt-0">Edit Contact Profile</h3>
      <div class="settings-field mt-0">
        <label class="settings-label">Name:</label>
        <input id="prof-name" class="settings-input">
      </div>
      <div class="settings-field">
        <label class="settings-label">Profession:</label>
        <input id="prof-role" class="settings-input">
      </div>
      <div class="settings-field">
        <label class="settings-label">Relationship:</label>
        <input id="prof-rel" class="settings-input">
      </div>
      <div class="settings-field mb-md">
        <label class="settings-label">Notes:</label>
        <textarea id="prof-notes" class="settings-input" style="height:60px; resize:vertical;"></textarea>
      </div>
      <input type="hidden" id="prof-handle">
      <div class="settings-button-group mt-0">
        <button onclick="closeProfileModal()" class="btn btn-ghost mx-sm">Cancel</button>
        <button id="save-profile-btn" onclick="saveProfile(this)" class="btn btn-primary mx-sm">Save Profile</button>
      </div>
    </div>
  </div>

  <!-- DOMPurify for XSS protection -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
  <!-- Application Modules (ES6) -->
  <!-- Global Spinner Overlay -->
  <div id="global-spinner" class="spinner-overlay">
    <div class="spinner"></div>
  </div>

  <!-- Global Toast Container -->
  <div id="toast-container"></div>

  <script type="module" src="js/app.js?v=2.1"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        if (!window.saveInlineProfile) {
          console.error('[CRITICAL] KYC handlers NOT found on window!');
          // alert('Warning: System components failed to initialize. Please check console.');
        } else {
          console.log('[READY] KYC handlers found on window.');
        }
      }, 1000); // Wait for modules to initialize
    });
  </script>
</body>

</html>