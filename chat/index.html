<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reply Hub v2</title>
  <link rel="stylesheet" href="css/global.css">
  <link rel="stylesheet" href="css/app.css">
</head>

<body>
  <div class="app-container">
    <!-- PANE A: SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div>
          <h2 style="margin:0; font-size: 1.1rem;">Reply Hub</h2>
          <div id="sync-status" style="font-size: 0.7rem; color: #888; margin-top: 4px;">Ready</div>
        </div>
        <!-- Sync buttons moved to individual cards -->
      </div>
      <div id="contact-list" class="contact-list">
        <!-- Contact Items will be injected here -->
        <div class="contact-item active">
          <span class="status-dot">üü†</span>
          <div class="contact-info">
            <div class="contact-name">Agneta</div>
            <div class="contact-preview">Draft ready: "Let's meet tomorrow..."</div>
          </div>
          <span class="channel-icon">üí¨</span>
        </div>
      </div>
    </aside>

    <!-- PANE B: MAIN CHAT -->
    <main class="chat-area">
      <header class="chat-header">
        <div style="display:flex; align-items:center; gap:12px;">
          <div id="active-contact-name-chat" style="font-weight: 700; font-size: 1.1rem;">Select a contact</div>
          <select id="status-select" onchange="updateManualStatus()"
            style="font-size:0.8rem; border-radius:12px; border:1px solid #ddd; padding:2px 8px; cursor:pointer; display:none;">
            <option value="open">üü¢ Active</option>
            <option value="draft">üü† Draft Ready</option>
            <option value="closed">üîµ Resolved</option>
          </select>
        </div>
        <div style="display: flex; gap: 10px;">
          <button class="btn btn-ghost">Refine</button>
          <button class="btn btn-primary" id="btn-suggest">Suggest Draft</button>
        </div>
      </header>

      <div class="input-area" style="border-top:none; border-bottom:1px solid var(--border);">
        <div class="input-wrapper">
          <textarea id="chat-input" placeholder="Type a message or let me suggest..."></textarea>
          <button id="btn-mic" class="btn-icon" title="Voice Input">üé§</button>
          <button class="btn-icon">‚ú®</button>
          <button id="btn-send" class="btn btn-primary">Send iMessage</button>
        </div>
      </div>

      <div id="messages" class="messages-container">
        <button id="btn-load-older" class="load-more-btn"
          style="display:none; color:var(--text-dim); background:rgba(0,0,0,0.03); border-radius:12px; margin-bottom:1rem;"
          onclick="loadMoreMessages()">Load Older Messages</button>
        <!-- Messages will be injected here -->
      </div>

      <div id="dashboard" class="dashboard" style="display:none;">
        <!-- Dashboard items will be injected here -->
      </div>
    </main>

    <!-- PANE C: KYC DATA -->
    <section class="kyc-pane">
      <div id="kyc-empty-state" style="padding:20px; text-align:center;">
        <h3 style="color:var(--text-dim);">Hub Overview</h3>
        <p style="font-size:0.85rem; color:#888;">Select a contact from the sidebar to view their profile and history.
        </p>
        <div style="margin-top:40px; border-top:1px solid #eee; padding-top:20px;">
          <div style="font-size:0.7rem; font-weight:700; color:#ddd; text-transform:uppercase;">Quick Tip</div>
          <div style="font-size:0.85rem; color:#aaa; margin-top:8px;">You can search contacts by name or handle.</div>
        </div>
      </div>

      <div id="kyc-content-editor" style="display:none;">
        <div style="display: flex; justify-content: space-between; align-items: baseline;">
          <h3 style="margin-top:0;">Profile</h3>
          <div style="display:flex; gap:5px;">
            <button id="btn-deep-analyze" class="btn-ghost" style="font-size:0.75rem; padding: 4px 8px;"
              title="Run Deep Analysis with Ollama">‚ú® Analyze</button>
            <button class="btn btn-primary" style="font-size:0.75rem; padding: 4px 8px;"
              onclick="saveInlineProfile()">Save Changes</button>
          </div>
        </div>
        <!-- KYC Cards follow... -->

        <div class="kyc-card">
          <div id="suggested-kyc-alert"
            style="display:none; background: #fff8e1; border: 1px solid #ffe082; border-radius: 6px; padding: 10px; margin-bottom: 1rem;">
            <div
              style="font-size: 0.75rem; font-weight: 700; color: #795548; margin-bottom: 5px; display: flex; justify-content: space-between;">
              <span>ü§ñ AI SUGGESTED UPDATE</span>
              <span onclick="dismissKYC()" style="cursor:pointer;" title="Dismiss">‚úï</span>
            </div>
            <div id="suggested-kyc-content" style="font-size: 0.85rem; color: #5d4037; font-style: italic;">
              <!-- Content injected via JS -->
            </div>
            <div style="margin-top: 8px; display: flex; gap: 8px;">
              <button class="btn btn-primary" style="font-size: 0.7rem; padding: 3px 8px;" onclick="acceptKYC()">‚úÖ
                Accept</button>
              <button class="btn-ghost" style="font-size: 0.7rem; padding: 3px 8px;" onclick="editKYC()">üìù
                Edit</button>
            </div>
          </div>

          <div style="margin-bottom: 0.8rem;">
            <label style="font-size: 0.7rem; color: #888; text-transform: uppercase;">Display Name</label>
            <input id="kyc-name-input"
              style="width:100%; border:none; border-bottom:1px solid transparent; font-weight:700; font-size:1rem; padding: 2px 0;"
              onfocus="this.style.borderBottom='1px solid var(--primary)'"
              onblur="this.style.borderBottom='1px solid transparent'">
          </div>

          <div style="margin-bottom: 0.8rem;">
            <label style="font-size: 0.7rem; color: #888; text-transform: uppercase;">Profession</label>
            <input id="kyc-role-input"
              style="width:100%; border:none; border-bottom:1px solid transparent; font-size:0.9rem; padding: 2px 0;"
              onfocus="this.style.borderBottom='1px solid var(--primary)'"
              onblur="this.style.borderBottom='1px solid transparent'">
          </div>

          <div style="margin-bottom: 0.8rem;">
            <label style="font-size: 0.7rem; color: #888; text-transform: uppercase;">Relationship</label>
            <input id="kyc-rel-input"
              style="width:100%; border:none; border-bottom:1px solid transparent; font-size:0.9rem; padding: 2px 0;"
              onfocus="this.style.borderBottom='1px solid var(--primary)'"
              onblur="this.style.borderBottom='1px solid transparent'">
          </div>

          <div style="margin-bottom: 0.8rem;">
            <label style="font-size: 0.7rem; color: #888; text-transform: uppercase;">Handle</label>
            <input id="kyc-handle-input" readonly
              style="width:100%; border:none; font-size:0.8rem; color:#666; background:transparent;">
          </div>

          <div style="margin-top: 1.5rem;">
            <label style="font-size: 0.7rem; color: #888; text-transform: uppercase; font-weight:700;">Local
              Intelligence
              (Notes Log)</label>
            <div id="notes-log"
              style="margin-top:0.5rem; max-height: 250px; overflow-y: auto; border: 1px solid var(--border); border-radius: 8px; padding: 5px; background: #fff;">
              <!-- Notes injected here -->
            </div>
            <div style="margin-top: 0.8rem; display: flex; gap: 8px;">
              <input id="new-note-input" placeholder="Add a new observation..."
                style="flex:1; padding: 6px 10px; border: 1px solid var(--border); border-radius: 20px; font-size: 0.85rem;">
              <button class="btn-icon" onclick="addNote()"
                style="background: var(--primary); color: white; border: none; width: 30px; height: 30px;">+</button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Profile Edit Modal -->
  <div id="profile-modal" class="modal-overlay">
    <div class="modal-content">
      <h3 style="margin-top:0;">Edit Contact Profile</h3>
      <div style="margin-bottom: 0.5rem;">
        <label style="font-size:0.8rem; color:#666;">Name:</label>
        <input id="prof-name" style="width:100%; padding:0.4rem; border:1px solid #ccc; border-radius:4px;">
      </div>
      <div style="margin-bottom: 0.5rem;">
        <label style="font-size:0.8rem; color:#666;">Profession:</label>
        <input id="prof-role" style="width:100%; padding:0.4rem; border:1px solid #ccc; border-radius:4px;">
      </div>
      <div style="margin-bottom: 0.5rem;">
        <label style="font-size:0.8rem; color:#666;">Relationship:</label>
        <input id="prof-rel" style="width:100%; padding:0.4rem; border:1px solid #ccc; border-radius:4px;">
      </div>
      <div style="margin-bottom: 1rem;">
        <label style="font-size:0.8rem; color:#666;">Notes:</label>
        <textarea id="prof-notes"
          style="width:100%; height:60px; padding:0.4rem; border:1px solid #ccc; border-radius:4px;"></textarea>
      </div>
      <input type="hidden" id="prof-handle">
      <div style="display:flex; justify-content:flex-end; gap:0.5rem;">
        <button onclick="closeProfileModal()"
          style="background:#eee; color:#333; border:1px solid #ccc; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">Cancel</button>
        <button onclick="saveProfile()"
          style="background:#056; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">Save
          Profile</button>
      </div>
    </div>
  </div>


  <!-- Application Modules (ES6) -->
  <script type="module" src="js/app.js"></script>
</body>

</html>